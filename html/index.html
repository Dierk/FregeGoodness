<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="Dierk König, @mittie">
<title>Frege Goodness</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{font-weight: normal}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#00}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Frege Goodness</h1>
<div class="details">
<span id="author" class="author">Dierk König, @mittie</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#magical_trick">A magical trick</a>
<ul class="sectlevel2">
<li><a href="#_more_examples">More Examples</a></li>
<li><a href="#_references">References</a></li>
</ul>
</li>
<li><a href="#qc_property">A Simple QuickCheck Property</a>
<ul class="sectlevel2">
<li><a href="#_more_examples_2">More Examples</a></li>
<li><a href="#_references_2">References</a></li>
</ul>
</li>
<li><a href="#silence">Silent notation</a>
<ul class="sectlevel2">
<li><a href="#_function_application">Function application</a></li>
<li><a href="#_the_dollar_sign">The dollar sign</a></li>
<li><a href="#_function_composition">Function composition</a></li>
<li><a href="#_functions_are_lambdas">Functions are lambdas</a></li>
<li><a href="#_point_free_style">Point-free style</a></li>
<li><a href="#_references_3">References</a></li>
</ul>
</li>
<li><a href="#immutables">Efficient Immutables</a>
<ul class="sectlevel2">
<li><a href="#_custom_data_structures">Custom Data Structures</a></li>
<li><a href="#_more_considerations">More Considerations</a></li>
<li><a href="#_references_4">References</a></li>
</ul>
</li>
<li><a href="#easy_io">Easy IO</a>
<ul class="sectlevel2">
<li><a href="#_the_code_java_vs_groovy_vs_frege">The code: Java vs Groovy vs Frege</a></li>
<li><a href="#_who_is_more_explicit">Who is more explicit?</a></li>
<li><a href="#_the_fundamental_difference">The fundamental difference</a></li>
<li><a href="#_summary">Summary</a></li>
<li><a href="#_the_domain_model">The domain model</a></li>
<li><a href="#_how_big_is_the_bank">How big is the bank?</a></li>
<li><a href="#_the_do_notation_and_comprehension">The "do" notation and comprehension</a></li>
<li><a href="#_path_queries_almost_sql">Path queries - almost SQL</a></li>
<li><a href="#_it_all_falls_in_place">It all falls in place</a></li>
<li><a href="#_references_5">References</a></li>
</ul>
</li>
<li><a href="#maybe_path">The Maybe path</a>
<ul class="sectlevel2">
<li><a href="#_the_domain_model_2">The domain model</a></li>
<li><a href="#_first_cut">First cut</a></li>
<li><a href="#_improving_on_notation">Improving on notation</a></li>
<li><a href="#_the_do_notation_again">The "do" notation, again</a></li>
<li><a href="#_comparing_approaches">Comparing approaches</a></li>
<li><a href="#_references_6">References</a></li>
</ul>
</li>
<li><a href="#fizzbuzz">FizzBuzz</a>
<ul class="sectlevel2">
<li><a href="#_the_pieces">The pieces</a></li>
<li><a href="#_combining_rules">Combining rules</a></li>
<li><a href="#_combine_with_numbers">Combine with numbers</a></li>
<li><a href="#_considerations">Considerations</a></li>
<li><a href="#_references_7">References</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>A a series of short, hopefully informative, and briefly commented snippets and thoughts about
the <a href="http://www.frege-lang.org">Frege programming language</a>.
The latest post is always available <a href="http://dierk.github.io/FregeGoodness/html/latest.html">here</a>.
Feel free to file <a href="https://github.com/Dierk/FregeGoodness/tree/gh-pages">issues, comments, and pull requests</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="magical_trick">A magical trick</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, think of a function <em>f</em> that maps a lists of arbitrary element types to another list of the exact same type.</p>
</div>
<div class="paragraph">
<p>In Frege terms, such a function <em>f</em> is declared as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">    f :: [a] -&gt; [a]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Assume nothing</div>
We cannot assume anything about the features of <em>a</em>.
      That very much limits what <em>f</em> can possibly do.
      For example, <em>f</em> cannot add "plus one" to all elements since <em>a</em> is not known to support arithmetic.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now, really, go for it. <strong>Think of any such function <em>f</em> and keep it secret!</strong></p>
</div>
<div class="paragraph">
<p>Second, think of any <em>specific</em> function <em>g</em> with type <code>a -&gt; b</code> that for a given type returns a value of some other type.
For example, you can choose:</p>
</div>
<div class="listingblock">
<div class="title">An example for <em>g</em> as a function from Int to String</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">    g :: Int -&gt; String
    g x = show x ++ show x ++ show x</code></pre>
</div>
</div>
<div class="paragraph">
<p>That is, <code>g 1</code> would return the String <code>"111"</code>.</p>
</div>
<div class="paragraph">
<p>But you can really think of any specific function <em>g</em> you fancy.</p>
</div>
<div class="ulist">
<div class="title">Here is the first part of the trick</div>
<ul>
<li>
<p>make a list of values that could be passed into <em>g</em> (a list of Int values in our example above)</p>
</li>
<li>
<p>now, apply your secret <em>f</em> to that list</p>
</li>
<li>
<p>then feed the result into <code>map g</code></p>
</li>
<li>
<p>you now have a list of return values of <em>g</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Do you have it?</p>
</div>
<div class="ulist">
<div class="title">Now the second part</div>
<ul>
<li>
<p>start with the same list as you started part 1 with</p>
</li>
<li>
<p>now, <strong>first</strong> apply <code>map g</code> to the list</p>
</li>
<li>
<p>then apply your secret function <em>f</em></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="title">TADAAA!</div>
You will arrive at the same result again!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s try with an example. Assume we had chosen the <code>reverse</code> function for <em>f</em>.<br>
<em>This is what you had in mind anyway, right?</em></p>
</div>
<div class="paragraph">
<p>Starting with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">    [1, 2, 3]</code></pre>
</div>
</div>
<div class="paragraph">
<p>applied to <em>reverse</em> is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">    reverse [1,2,3]</code></pre>
</div>
</div>
<div class="paragraph">
<p>fed into <code>map g</code> and successively substituting the definitions gives us</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">    map g (reverse [1,2,3])
    map g [3, 2, 1]
    [&quot;333&quot;, &quot;222&quot;, &quot;111&quot;]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the other way around: first mapping, then reversing</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">    reverse (map g [1, 2, 3])
    reverse [&quot;111&quot;, &quot;222&quot;, &quot;333&quot;]
    [&quot;333&quot;, &quot;222&quot;, &quot;111&quot;]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Voilà, same result!</strong></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
This is a pretty interesting theorem that only holds in the purely functional world.
     If we had any kind of assignments, state, or effects, we could not possibly hope for
     a theorem that allows us <strong>safe reordering</strong>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is a graphical representation of the theorem.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="functor_composition.png" alt="Commutative diagram for functor composition." width="360" height="210">
</div>
<div class="title">Figure 1. Commutative diagram for functor composition.</div>
</div>
<div class="paragraph">
<p>We start at the upper left corner to reach the lower right one. We can go either way (first right, then down or
first down, then right) to arrive at the same result.</p>
</div>
<div class="paragraph">
<p>The <code>///</code> in the diagram is the mathematical notation to say that that the diagram <em>commutes</em>.<br>
<em>When we covered this in school math, I assumed this would never be of any practical relevance
to me. Boy, was I wrong!</em></p>
</div>
<div class="sect2">
<h3 id="_more_examples">More Examples</h3>
<div class="paragraph">
<p>We do not have many restrictions on <em>g</em> (beside being a pure function).
It even works when <em>g</em> returns an IO type like <code>IO ()</code> when g was the function <code>g x = println x</code>.
The result would be a list of (yet unperformed) IO actions in that case, which can still be reversed
like any other list.</p>
</div>
<div class="paragraph">
<p>The situation is different for <em>f</em>. There are not so many functions that map <code>[a]</code> to <code>[a]</code>.
But when you <em>hoogle</em> for the
type, a few interesting ones show up. Beside <code>reverse</code>, there is of course <code>id</code> but also
<code>tail</code> (all but the first element), <code>init</code> (all but the last element), and <code>cycle</code>,
which produces an infinite list by endlessly repeating the current list.</p>
</div>
<div class="paragraph">
<p>That brings to mention that the theorem works also perfectly well on infinite lists
in a lazy language like Frege.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Purity for the win</div>
Does our theorem apply to other JVM languages as well? No.<br>
      The theorem requires pure functions.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_references">References</h3>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Hoogle [a]&#8594;[a]
</td>
<td class="hdlist2">
<p><a href="https://www.haskell.org/hoogle/?hoogle=%5Ba%5D+-%3E+%5Ba%5D" class="bare">https://www.haskell.org/hoogle/?hoogle=%5Ba%5D+-%3E+%5Ba%5D</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
Phil Wadler
</td>
<td class="hdlist2">
<p>Tech Mesh 2012 - Faith, Evolution, and Programming Languages: from Haskell to Java
<a href="https://www.youtube.com/watch?v=NZeDRs6snm0" class="bare">https://www.youtube.com/watch?v=NZeDRs6snm0</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
Functor
</td>
<td class="hdlist2">
<p><a href="http://en.wikipedia.org/wiki/Functor" class="bare">http://en.wikipedia.org/wiki/Functor</a></p>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="qc_property">A Simple QuickCheck Property</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Frege comes with a testing facility that enables <em>property-based</em> testing.<br>
Let&#8217;s have a first glance on what we can do with it.</p>
</div>
<div class="paragraph">
<p>In the post "<a href="#magical_trick">A magical trick</a>" we worked with these functions <em>f</em> and <em>g</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">    f :: [a] -&gt; [a]  -- we should think of any such function
    f  = reverse     -- that was our pick

    g :: Int -&gt; String
    g x = show x ++ show x ++ show x</code></pre>
</div>
</div>
<div class="paragraph">
<p>We found that we can freely choose between</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">    map g (f [1, 2, 3])</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">    f (map g [1, 2, 3])</code></pre>
</div>
</div>
<div class="paragraph">
<p>to arrive at the same result.</p>
</div>
<div class="paragraph">
<p>In other words, we found a property (I prefer the term <em>invariant</em>) that we can test.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">For the JUnit folks</div>
<div class="paragraph">
<p>If you come from a JUnit background, your current consideration is most likely
"which test cases will we supply?"<br>
And the answer is "we don&#8217;t care. We will let the tool pick from the domain - randomly!"</p>
</div>
<div class="paragraph">
<p>This sounded totally silly to me when I first encountered it. But there is actually some benefit to it
and - don&#8217;t be afraid - one can still do single, hard-coded test cases to e.g. cover the corner cases.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Here is how we can define a property in Frege with QuickCheck:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">    import frege.test.QuickCheck

    commutativity xs = property ( map g (f xs) == f (map g xs) )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Having defined this property, we can quickly check whether it holds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">    quickCheck commutativity</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which yields us</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+++ OK, passed 100 tests.</pre>
</div>
</div>
<div class="paragraph">
<p>That is seriously surprising! How could QuickCheck possibly know what test data
to generate for the 100 tests? We did not even tell it the argument type!<br>
The clever Frege type inference comes into play here.</p>
</div>
<div class="paragraph">
<p>To see the inferred type of <em>commutativity</em> we can ask the REPL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    :t commutativity
    [Int] -&gt; Bool</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s follow through what the Frege type inference engine must have considered:</p>
</div>
<div class="paragraph">
<p>The function <em>g</em> takes an <code>Int</code> argument
and the argument to <code>map g</code> must be a list of the arguments to <em>g</em>, therefore,
<em>xs</em> can only be a list of <code>Int</code> values. Furthermore, <em>f</em> works on a list of any types and thus
imposes no further restrictions.</p>
</div>
<div class="paragraph">
<p>There is some reasonably advanced thinking involved to arrive at the same
conclusion that Frege infers at compile time.</p>
</div>
<div class="paragraph">
<p>Knowing that <em>xs</em> is of type <code>[Int]</code>, <em>quickCheck</em> can ask the list type to produce
arbitrary values of itself (in various sizes), while lists in turn ask <code>Int</code> to
also produce arbitrary <code>Int</code> values. This works in a type-safe manner since both
<code>List</code> and <code>Int</code> are instances of the Arbitrary <em>typeclass</em>: they belong to the class
of types that know how to generate arbitrary values of their type.</p>
</div>
<div class="paragraph">
<p>We haven&#8217;t talked about the function <em>property</em>, yet. What is that for?
Well, while the test above runs perfectly well without it, there is value in wrapping the boolean
expression in a <code>Property</code> type. One benefit is that the QuickCheck <em>tool</em> can scan
for all functions of that type and run them all at once without resorting to any conventions
like "must start with prop_" or so.</p>
</div>
<div class="sect2">
<h3 id="_more_examples_2">More Examples</h3>
<div class="paragraph">
<p>We claimed that we can choose any functions <em>f</em> and <em>g</em> that satisfy our types.
Try a few and do you very best to break the invariant! Honestly, do it!
You will learn something.</p>
</div>
<div class="paragraph">
<p>Hint: When you try with infinite lists or functions <em>g</em> that have a side-effect,
you will run into issues with checking for equality. Reading the paper below may help, then.</p>
</div>
<div class="paragraph">
<p><em>There is so much more to say about QuickCheck. We will do so in future posts.</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_references_2">References</h3>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Koen Claessen, John Hughes
</td>
<td class="hdlist2">
<p>QuickCheck: A Lightweight Tool for Random Testing of Haskell Programs
<a href="http://www.eecs.northwestern.edu/~robby/courses/395-495-2009-fall/quick.pdf" class="bare">http://www.eecs.northwestern.edu/~robby/courses/395-495-2009-fall/quick.pdf</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
The tool
</td>
<td class="hdlist2">
<p><a href="https://github.com/Frege/frege/wiki/Getting-Started#quickcheck" class="bare">https://github.com/Frege/frege/wiki/Getting-Started#quickcheck</a></p>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="silence">Silent notation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a language that is built from functions and expressions, one can reasonably
expect to see a lot of parentheses. It is no coincidence that LISP is humorously known
for its proverbial overload with parentheses.</p>
</div>
<div class="paragraph">
<p>Frege has a very silent notation, though, and supports a coding style that
uses very little parentheses at all.</p>
</div>
<div class="paragraph">
<p>Lets start with function application.</p>
</div>
<div class="sect2">
<h3 id="_function_application">Function application</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">    f(x)    -- as known from many languages
    f x     -- Frege style (like linear functions in mathematics)
    f $ x   -- explicit function application with the $ operator
    f(x,y)  -- taking a tuple as an argument
    f x y   -- same as ((f x) y)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Frege uses the blank character - the most silent one in the character set -
to denote function application. Function application has the highest
precedence of all operators. It binds more tightly than all others.
It is also left associative such that <code>f x y</code> is really
two function applications: first <code>f x</code>, which returns a function that then takes
<code>y</code> as an argument.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>The last example is usually called <em>currying</em> or <em>partial function application</em>.
But there is technically nothing <em>partial</em> about it. It is just so that
<em>f</em> is a function that takes <em>x</em> and returns another function
(which in turn than takes <em>y</em>). Functions that return functions were first described by Gottlob Frege
back in the 19<sup>th</sup> century.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_dollar_sign">The dollar sign</h3>
<div class="paragraph">
<p>When a function application like <code>g x</code> appears as an argument to <em>f</em> then
it must be written in parentheses like <code>f (g x)</code> because otherwise, <em>g</em> would
become an argument to <em>f</em>, which is not what we want. This can get unwieldy
when the nesting gets deeper and therefore there is an alternative using
the dollar sign.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">    foo (bar (baz (buz x)))  -- deeply nested style
    foo $ bar $ baz $ buz x  -- flat $ style</code></pre>
</div>
</div>
<div class="paragraph">
<p>Interestingly, the <em>$</em> operator is not a language construct. It is an ordinary
function that is declared as an infix operator. The definition of <em>$</em> is
<code>f $ x = f x</code> . The trick is that <em>$</em> has very low operator precedence and therefore
all operators to its right (and analogously to the left as we will see later)
are applied before its result is finally applied to <em>f</em>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>The net effect is that when you see a <em>$</em> you can mentally replace it with
parentheses that enclose the rest of the expression.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_function_composition">Function composition</h3>
<div class="paragraph">
<p>Now, even if we love to see dollars, the <em>$</em> operator is certainly not very silent in its appearance, but
the dot-operator is. It it the operator for <em>function composition</em>:
<code>f(g(x))</code> can - just like in school math - be written as <code>(f • g) x</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">    (foo . bar . baz . buz) x  -- function composition with dot
    (foo • bar • baz • buz) x  -- Frege also allows unicode 2022</code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>When looking at function composition it is best to <strong>read it right-to-left</strong> since
first <code>buz x</code> is evaluated, then <code>baz</code>, then <code>bar</code>, and finally <code>foo</code> -
in the exact same order as when writing the nested parentheses.</p>
</div>
<div class="paragraph">
<p>In fact, it is very similar to how pipes work on unix systems (only the direction is reversed).</p>
</div>
</div>
</div>
<div class="paragraph">
<p>We said that function application has the highest precedence - even higher
than function composition.
Therefore, we need the parentheses above to prevent the binding between
<em>buz</em> and <em>x</em>. But, hey, we learned that dollar has lowest precedence,
so putting that in between should also work, right? Yes it does.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">    foo . bar . baz . buz $ x  -- this is not used so often</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, can we shave the <em>x</em> off such that we can drop dollars and parens as well?</p>
</div>
<div class="paragraph">
<p>Yes, but that needs a bit of background.</p>
</div>
</div>
<div class="sect2">
<h3 id="_functions_are_lambdas">Functions are lambdas</h3>
<div class="paragraph">
<p>Let&#8217;s assume we have a method <code>inc</code> that just adds 1 to its argument.
There are two equivalent ways of writing this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">    inc x = x + 1           -- usual function definition
    inc   = \x -&gt; x + 1     -- equivalent lambda style</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_point_free_style">Point-free style</h3>
<div class="paragraph">
<p>Now if we want a function <em>f</em> to work like <em>inc</em>, we can use <em>inc</em>
in the definition of <em>f</em> and relay the argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">    f x   = inc x           -- f should be like inc
    f     = inc             -- point-free style, &quot;cancel x&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>But we can even cancel down the <em>x</em> such that <em>f</em> looks like an alias
for <em>inc</em>. And here is proof that this is a valid transformation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">    f     = inc             -- beta reduction =&gt;
    f     = \x -&gt; x + 1     -- replace formal lambda parameter with free variable =&gt;
    f x   = x + 1           -- same as definition of inc</code></pre>
</div>
</div>
<div class="paragraph">
<p>This finally leaves us with four ways of defining our function:</p>
</div>
<div class="listingblock">
<div class="title">The final overview of all four styles</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">    f x =  foo (bar (baz (buz x)))    -- deeply nested style
    f x =  foo $ bar $ baz $ buz x    -- flat $ style
    f x = (foo . bar . baz . buz) x   -- function composition
    f   =  foo . bar . baz . buz      -- point-free style</code></pre>
</div>
</div>
<div class="paragraph">
<p>Keeping the above equivalence in mind should help you to become
confident with these options when writing your own code but even more so
when reading other developer&#8217;s code.</p>
</div>
<div class="paragraph">
<p>You will find all four styles in any reasonably sized program.
For example, we have used the point-free style in the previous post, when
we said <code>f = reverse</code> and I&#8217;m sure you guessed the meaning even
though it was not explained. We could have said <code>f x = reverse x</code> but there
is a subtle distinction - not in what the code does but in what it
communicates:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>f</code> <em>is the function</em> <code>reverse</code></p>
</li>
<li>
<p><code>f</code> is <em>doing</em> <code>reverse</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The prototypical adoption cycle for newcomers is: they are first puzzled by
the point-free style, then excited, then they overuse it, then they settle
at a reasonable dose.</p>
</div>
</div>
<div class="sect2">
<h3 id="_references_3">References</h3>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Frege Language Reference
</td>
<td class="hdlist2">
<p><a href="http://www.frege-lang.org/doc/Language.pdf" class="bare">http://www.frege-lang.org/doc/Language.pdf</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
Declaration of the $ function
</td>
<td class="hdlist2">
<p><a href="https://github.com/Frege/frege/blob/master/frege/prelude/PreludeBase.fr#L109-109" class="bare">https://github.com/Frege/frege/blob/master/frege/prelude/PreludeBase.fr#L109-109</a>
where line numbers might change</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="immutables">Efficient Immutables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A cornerstone of functional programming is to work almost exclusively on values.
Values never change. 42 is 42 and when you apply the function
<code>(+1)</code> to it, then it will return 43 but 42 remains to be 42.</p>
</div>
<div class="paragraph">
<p>Values are immutable.</p>
</div>
<div class="paragraph">
<p>This is quite obvious for the case of numbers. But how about Strings? Most popular languages
treat them as immutable values. This has the benefit that we can safely
pass them around without worries that some other code may change their content.</p>
</div>
<div class="paragraph">
<p>Frege extends the benefits of immutability to all pure<sup>*</sup> data structures,
including lists, maps and other standard data structures as well your self-made ones!</p>
</div>
<div class="paragraph">
<p>(*) <em>Pure means that the data structure doesn&#8217;t announce any state change or other side effect in its type</em>.</p>
</div>
<div class="paragraph">
<p>This may sound totally unpractical when you come from an object-oriented background and you
may ask if that doesn&#8217;t lead to extensive copying and memory exhaustion.
It turns out that when <em>consequently</em> programming with values there is only a surprisingly small price to pay
for a huge number of benefits.</p>
</div>
<div class="sect2">
<h3 id="_custom_data_structures">Custom Data Structures</h3>
<div class="paragraph">
<p>Let&#8217;s start with common, simple data structure: a <code>Person</code> that has a first name, a last name, and
thinks in a certain programming language.</p>
</div>
<div class="listingblock">
<div class="title">A simple Person data type</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">    data Person = Person { firstname, lastname, language :: String }

    javaDierk   = Person &quot;Dierk&quot; &quot;König&quot; &quot;Java&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we create a the <code>javaDierk</code> value of that <code>Person</code> type it is automatically immutable!</p>
</div>
<div class="paragraph">
<p>There are actually two separate features of the language that we see here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Frege has no assignments, so the <code>=</code> sign above denotes a <em>definition</em> not an assignment.
In particular, we cannot redefine <code>javaDierk</code> to point to some other person. Whoever references
<code>javaDierk</code> will once and forever see the "thinking in Java" version of me.</p>
</li>
<li>
<p>We cannot change the person value itself. But we can create new value, based on the given one.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Changing a field creates a copy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">    groovyDierk = javaDierk.{ language = &quot;Groovy&quot; }
    fregeDierk  = javaDierk.{ language = &quot;Frege&quot;  }</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
There are many interesting ways to work with the <em>record syntax</em> that we will cover in a future post.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For now, we have three distinct <code>Person</code> values. With every change we get a
new copy. What looked like "setters" works actually more like a <em>copy constructor</em>.</p>
</div>
<div class="paragraph">
<p>But even though we have three copies, there is some automatic <em>structural sharing</em> going on
as depicted in the following figure:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Efficient_Immutables.png" alt="Efficient Immutables">
</div>
<div class="title">Figure 2. Efficient immutables through structural sharing</div>
</div>
<div class="paragraph">
<p>Since we are <em>consequently</em> working with values, we can <em>always</em> safely share not only
String values as in the example above but <em>every</em> value. Note that this property could not be achieved
if we would allow any kind of mutability to silently creep in.</p>
</div>
<div class="paragraph">
<p>But what if I have a really big data structure and make a real lot of changes to it?
Well, let&#8217;s try. Assume we have a value of the data structure <code>D</code> with a field <code>x</code> that contains
a million Strings (maybe subject to lazy evaluation).
Then we update a second field <code>y</code> a million times. This will produce a million copies
and we are crazy enough to hold on to each and every copy to prevent early garbage collection.</p>
</div>
<div class="paragraph">
<p>Even this crazy scenario only produces the tiny rightmost blue hump in memory consumption that you see
in the magnifier glass below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Immutable_memory_consumption.png" alt="Immutable memory consumption">
</div>
<div class="title">Figure 3. Efficient, GC-friendly memory consumption</div>
</div>
<div class="paragraph">
<p>Note that the <em>list of Strings</em> is just as immutable as a single String and can thus be safely shared
between all copies of <code>D</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Sharing is good</div>
<div class="paragraph">
<p>In his awesome talks, Venkat Subramaniam likes to mention that mom always told us: "sharing is good".</p>
</div>
<div class="paragraph">
<p>And, yes, I&#8217;m happy to share my toys with anybody, provided that nobody can break them - and that I can
retain a copy for myself (this is where most analogies with software tend to break).</p>
</div>
</div>
</div>
<div class="paragraph">
<p>It goes without saying that immutable data structures can not only be shared safely between
API providers and consumers in a single-threaded scenario but also between <em>concurrent</em> and
massively <em>parallel</em> computations.</p>
</div>
<div class="paragraph">
<p>The small price we pay is a little bit of temporary memory and some extra time for garbage collection.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="title">Immutable by default</div>
The best of all: we did not write a single character to make that all work!<br>
We did not invest a single brain cycle. It is all automatic.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_more_considerations">More Considerations</h3>
<div class="paragraph">
<p>Deeply nested data structures are notoriously expensive to copy and to compare.
Immutable data structures can often alleviate that burden by just copying or comparing
one single reference.
A good example is what we called the "copy constructor". Beside setting the provided value(s),
it just copies the top-level references and, yet, it is a <em>deep copy</em> anyway.</p>
</div>
<div class="paragraph">
<p>All standard data structures in Frege are immutable. This must be surprising if you come from the
OO world. We are so used that e.g. a map changes its content all the time. We may even consider
that to be a map&#8217;s main purpose in life! Now is the time to reconsider that world view.
In the references you will find information and inspiration about that topic.</p>
</div>
<div class="paragraph">
<p>Now what is <em>dierk&#8217;s</em> current language that he thinks in? Which of the three references do we use?
Wouldn&#8217;t it be better to keep just one reference around that points to "the latest"
<code>Person</code>? We will cover this scenario in a future post where we will also experience the
Frege "mechanics" that prevent such mutable state from undermining our immutable data structures.</p>
</div>
</div>
<div class="sect2">
<h3 id="_references_4">References</h3>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Chris Okasaki
</td>
<td class="hdlist2">
<p>"Purely Functional Data Structures"<br>
<a href="http://www.amazon.com/Purely-Functional-Structures-Chris-Okasaki/dp/0521663504" class="bare">http://www.amazon.com/Purely-Functional-Structures-Chris-Okasaki/dp/0521663504</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
Rich Hickey
</td>
<td class="hdlist2">
<p>Keynote: The Value of Values<br>
<a href="http://www.infoq.com/presentations/Value-Values" class="bare">http://www.infoq.com/presentations/Value-Values</a><br>
Persistent data structures<br>
<a href="https://www.youtube.com/watch?v=hb3rurFxrZ8" class="bare">https://www.youtube.com/watch?v=hb3rurFxrZ8</a> (min 20 ff)</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="easy_io">Easy IO</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Conventional wisdom has it that IO is difficult, cumbersome, if not even impossible
in pure functional programming.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see and compare the solutions for the simple case of a method (Java, Groovy) and function
(Frege) that prints 1, 2, 3 to the console.</p>
</div>
<div class="paragraph">
<p>This looks like an overly simplistic example but it actually has some interesting
lessons for us if we dare to question our familiar habits.</p>
</div>
<div class="sect2">
<h3 id="_the_code_java_vs_groovy_vs_frege">The code: Java vs Groovy vs Frege</h3>
<div class="paragraph">
<p>Here is the code for comparison.</p>
</div>
<div class="listingblock">
<div class="title">The Java method</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="comment">// Java</span>
    <span class="type">void</span> print123() {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>);
    }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">The Groovy method</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="comment">// Groovy</span>
    <span class="keyword">def</span> <span class="function">print123</span>() {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Groovy developer has a lot of choices. He can use the exact same syntax as in the
Java version and it will be valid Groovy. Here is a rather compact version.</p>
</div>
<div class="listingblock">
<div class="title">The Frege function</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">    -- Frege
    print123 = do
        println &quot;1&quot;
        println &quot;2&quot;
        println &quot;3&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Surprisingly, <strong>the Frege function is the shortest</strong> of all three, even slightly shorter
than the Groovy version by 4 characters! Furthermore, it has the least amount of punctuation.</p>
</div>
<div class="paragraph">
<p><em>There is an obvious repetition in the examples and in both Groovy and Frege we could compress the three lines
easily into a single one but we will leave that discussion for a future post</em>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Mythbuster</div>
<div class="paragraph">
<p>So the myth that pure functional programming makes IO difficult is easily debunked.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>But now comes the big surprise: Frege is not only the shortest, it is also the most explicit about the effect!</p>
</div>
</div>
<div class="sect2">
<h3 id="_who_is_more_explicit">Who is more explicit?</h3>
<div class="paragraph">
<p>Let&#8217;s see what each language announces in the type signature.</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Java
</td>
<td class="hdlist2">
<p>The method returns <code>void</code>. This tells pretty much nothing, whereas it at least assures that we
do not accidentally assign the return value to some reference since the Java compiler disallows that.
However, the signature tells nothing at all that we print to <code>stdout</code>. This is actually rather surprising.
<strong>Why is <code>println</code> not throwing an IOException</strong> such that we are forced to either catch it or
announce it in the signature? Furthermore, <code>System.out</code> is a <em>global, mutable field</em> that we
access <em>without any protection</em>. It would be conventional to have at least a getter method.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Groovy
</td>
<td class="hdlist2">
<p>Groovy has pretty much the same characteristics as Java beside that it is more honest about Exceptions:
it does not even pretend to enforce them. The <code>def</code> return type that we have chosen has the effect that the
method has a return value: the value of the last evaluated expression, which in our case is <code>null</code> since that
is what <code>println</code> returns. But again, that is the Groovy way: trust the programmer.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Frege
</td>
<td class="hdlist2">
<p>The code does not mention any type at all but that doesn&#8217;t mean that there isn&#8217;t any. The type is <em>inferred</em> and when
we ask the REPL with <code>:type print123</code> it tells us <code>IO ()</code> (pronounced "I - O - unit"), which is all the
information we need. It tells us that the function is (potentially) doing IO operations with all the implications that
may come with that. No other method can call us without also announcing IO in its type.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_the_fundamental_difference">The fundamental difference</h3>
<div class="paragraph">
<p>The fundamental difference is that in an imperative language like Java and Groovy there is technically no
connection between the three <code>println</code> statements. You can reorder them, you can interleave them with totally
unrelated computations, and you will not see that in the type signature.</p>
</div>
<div class="paragraph">
<p>The case is totally different in Frege. There are no statements, only expressions.</p>
</div>
<div class="paragraph">
<p><code>println "2"</code> and <code>println "3"</code> are not just two lines that happen sit beneath each other.
They have a very strong connection. In fact, they are both expressions that happen to be an argument
to a function that <em>binds</em> the two together with a logic that the <em>IO</em> type specifies.
The return type of <em>bind</em> is the return type of its second argument. In our case <code>IO ()</code> again.</p>
</div>
<div class="listingblock">
<div class="title">Returns IO () since (println "3") return IO ()</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pseudo">    bind (println &quot;2&quot;) (println &quot;3&quot;)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And, of course, the same is true for <code>println "1"</code>.</p>
</div>
<div class="listingblock">
<div class="title">Returns IO () since &#8230;&#8203; you get it, right?</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="pseudo">    bind (println &quot;1&quot;)  (bind (println &quot;2&quot;) (println &quot;3&quot;))</code></pre>
</div>
</div>
<div class="paragraph">
<p>So the whole function body that looked so imperative boils down to a single expression and
type inference becomes a piece of cake.</p>
</div>
<div class="paragraph">
<p>At this point, we have everything collapsed to a single expression until the <code>do</code> keyword, which
is calling the <em>bind</em> function of that single expression. Since our expression is
of type <code>IO</code>, the <code>IO.bind</code> will be used.</p>
</div>
<div class="paragraph">
<p>We have seen before, for example in "<a href="#silence">Silent Notation</a>", that functional programming
sometimes means to read backwards. This is again true for the do-notation. This time it is not
right-to-left but bottom-to-top to find the overall result type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">A personal experience</div>
It took me a while to understand how these mechanics work and in particular how on earth the <em>do</em> knows
which <em>bind</em> to use. There are many explanations around but that part was always missing for me -
probably because it was so obvious to everybody else.
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">By the way</div>
<div class="paragraph">
<p>When looking for the <em>bind</em> function, you will see that it is written as the <code>&gt;&gt;=</code> infix operator.
So <code>bind a b</code> appears as <code>a &gt;&gt;= b</code> (and there are a few variants that we will cover later).</p>
</div>
</div>
</div>
<div class="paragraph">
<p>As an aside, using <em>bind</em> like an infix operator</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    a `bind`
    b `bind`
    c</pre>
</div>
</div>
<div class="paragraph">
<p>reveals an interesting analogy. This is just like writing the imperative style of</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    a ;
    b ;
    c</pre>
</div>
</div>
<div class="paragraph">
<p>This is why <em>bind</em> is also humorously known as <em>the programmable semicolon</em>.
It provides the logic how two functions compose in a given context and - as we will see later -
how the first function can pass its result as an argument to the second function.</p>
</div>
</div>
<div class="sect2">
<h3 id="_summary">Summary</h3>
<div class="ulist">
<ul>
<li>
<p>IO code can be really easy to write even in a purely functional language like Frege.</p>
</li>
<li>
<p>Being purely functional does not mean that there is no IO. It means to be rigorously explicit about it.</p>
</li>
<li>
<p>Functional code can look like imperative code without sacrificing its functional nature.</p>
</li>
<li>
<p>Do-notation is your friend in the presence of side effects.
== List and path</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Lists are the predominant data structure in Frege and it will come at no surprise
that there are lots of clever ways of dealing with them.</p>
</div>
<div class="paragraph">
<p>We will start with a data model that is a dramatically simplified version of what you
may find in real life. From there we will explore various ways of
querying the data.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_domain_model">The domain model</h3>
<div class="paragraph">
<p>Let&#8217;s assume that a bank has many clients that hold many investment portfolios that
in turn are made of positions where each position tells how many items of a
financial instrument (let&#8217;s assume stock shares for a given ticker) are in that
portfolio.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="fpath_domain.png" alt="A simplified banking domain" width="610" height="98">
</div>
<div class="title">Figure 4. A simplified banking domain</div>
</div>
<div class="paragraph">
<p>The tickers are easily modeled with an enumeration</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">data Ticker = GOOG | MSFT | APPL | CANO | NOOB
derive Eq Ticker</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rest of the domain is just normal data structures in record syntax.</p>
</div>
<div class="listingblock">
<div class="title">The core domain data structures</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">data Bank       = Bank      { clients       :: [Client]     }
data Client     = Client    { portfolios    :: [Portfolio]  }
data Portfolio  = Portfolio { positions     :: [Position]   }
data Position   = Position  { soMany :: Int, ticker :: Ticker }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s create an example bank that has 1000 clients, each having 3 portfolios with various positions.</p>
</div>
<div class="listingblock">
<div class="title">Domain sample data</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">bank = Bank { clients = replicate 1000
    Client { portfolios = replicate 3
        Portfolio { positions = [
            Position { soMany = 1, ticker = APPL },
            Position { soMany = 2, ticker = MSFT },
            Position { soMany = 8, ticker = CANO }
        ]}
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you haven&#8217;t seen <code>replicate</code> before: it takes a size and an element and produces a list of
elements of that size. The type is<br>
<code>replicate :: Int -&gt; a -&gt; [a]</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Short and friendly to incremental development</div>
Defining the domain has been very short. Using positional parameters instead of record syntax would
have been even shorter. But so it is easier to extend the data structures later.<br>
Even the creation of many sample values was quick and it is easy to play around with various sizes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, we need some pricing information for our stock tickers for later valuation.
We use a simple association list.</p>
</div>
<div class="listingblock">
<div class="title">Defining prices as an association list</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">prices = [ (GOOG, 100) , (MSFT, 200) , (APPL, 300) , (CANO, 400) ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that there is no <code>NOOB</code> in the list of prices. We can use that later when testing the
lookup of prices for tickers that are not in the list.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s do that right away with invariants that tell how to value a position:
by multiplying the price of the ticker by how many we have of those.</p>
</div>
<div class="listingblock">
<div class="title">Testing the valuation of positions</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">import Test.QuickCheck

zeroValue     = once     $             0 == value (Position 5 NOOB)
multipleValue = property $ \n -&gt; 100 * n == value (Position n GOOG)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Writing the test made us think about the <code>NOOB</code> case: what should the value of a position be
if no price for the ticker can be found? We decided for <code>0</code>, which does the trick for our
application-level task at hand. A more widely used library function should rather
signal the error, maybe by returning a <code>Maybe</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When we go in this test-first style, the compiler will complain that there is no
<code>value</code> function. Let&#8217;s give it one, using the <code>lookup</code> function from <code>Data.List</code>
to find the price for the ticker.</p>
</div>
<div class="listingblock">
<div class="title">Implementing the value function</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">import Data.List (lookup)

value :: Position -&gt; Int
value position = calculate $ lookup position.ticker prices where
    calculate Nothing      = 0
    calculate (Just price) = position.soMany * price</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>lookup</code> function returns a <code>Maybe</code> since the lookup may fail and we draw
some attention to this possibility by defining the local <code>calculate</code>
function with case discrimination on whether the Maybe is <code>Nothing</code> or
<code>Just</code> the price. (The less dramatic alternative would have been to
to use the <code>maybe</code> function like <code>maybe 0 ...</code>)</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Why not null?</div>
<div class="paragraph">
<p>The Java developer in us may ask: Why not simply returning a <code>null</code> value
when a lookup fails? Well, as we all know, the caller may forget the null
check and a <strong>NullPointerException</strong> is likely to happen later - possibly far away
from the point where the null was set.</p>
</div>
<div class="paragraph">
<p>In Frege, <strong>there is no null</strong> and thus there are <strong>no NullPointerExceptions</strong> any more!</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_big_is_the_bank">How big is the bank?</h3>
<div class="paragraph">
<p>Banks are often compared by their <em>assets under management</em>, i.e. by the value
of all positions in all portfolios of all their clients.</p>
</div>
<div class="paragraph">
<p>Hey, we have the data to calculate that! And here are the functions that we need
to get to that data along with their types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>bank.clients         --              [Client]    <b class="conum">(1)</b>
Client.portfolios    -- Client    -&gt; [Portfolio] <b class="conum">(2)</b>
Portfolio.positions  -- Portfolio -&gt; [Position]  <b class="conum">(3)</b>
value position       -- Position  -&gt; Int</pre>
</div>
</div>
<div class="paragraph">
<p>Hm, something interesting becomes apparent here: <strong>each function returns a list
of elements that the next function needs as single elements</strong>.
So maybe we can generalize over this pattern and <em>bind</em> the functions
like we did in "<a href="#easy_io">Easy IO</a>".</p>
</div>
<div class="paragraph">
<p>So binding &lt;1&gt; and &lt;2&gt; would be</p>
</div>
<div class="listingblock">
<div class="content">
<pre>   &lt;1&gt;             &lt;2&gt;                 return type
[Client] -&gt; (Client -&gt; [Portfolio]) -&gt; [Portfolio]</pre>
</div>
</div>
<div class="paragraph">
<p>Binding &lt;2&gt; and &lt;3&gt; would be</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    &lt;2&gt;                   &lt;3&gt;               return type
[Portfolio] -&gt; (Portfolio -&gt; [Position]) -&gt; [Position]</pre>
</div>
</div>
<div class="paragraph">
<p>As you see, there is a general pattern behind it such that <em>bind</em> has the type:<br>
<code>[a] -&gt; (a -&gt; [b]) -&gt; [b]</code></p>
</div>
<div class="paragraph">
<p>You will be glad to hear that this <em>bind</em> function is already available and just like in the
case of "<a href="#easy_io">Easy IO</a>", it is denoted with the <code>&gt;&gt;=</code> operator.</p>
</div>
<div class="paragraph">
<p>So combining &lt;1&gt; and &lt;2&gt; becomes
<code>bank.clients &gt;&gt;= Client.portfolios</code></p>
</div>
<div class="paragraph">
<p>Combining &lt;2&gt; and &lt;3&gt; becomes
<code>Client.portfolios &gt;&gt;= Portfolio.positions</code></p>
</div>
<div class="paragraph">
<p>Combining (&lt;1&gt; and &lt;2&gt;) and &lt;3&gt; becomes<br>
<code>bank.clients &gt;&gt;= Client.portfolios &gt;&gt;= Portfolio.positions</code></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="title">Tadaaaa!</div>
We have arrived at a simple "path" expression for all positions of all portfolios for all the bank&#8217;s clients!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To finally drive the point home, here is the first version of calculating the assets under management
by using the <em>bind</em>, mapping positions to their values, and summing those up.</p>
</div>
<div class="listingblock">
<div class="title">Assets under management, first version</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">assetsUnderManagement1 = sum $
    map value $
        bank.clients &gt;&gt;= Client.portfolios &gt;&gt;= Portfolio.positions</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_do_notation_and_comprehension">The "do" notation and comprehension</h3>
<div class="paragraph">
<p>Another lesson from "<a href="#easy_io">Easy IO</a>" was that <em>bind</em> allows us to use the "do" notation, which
leads to the following code.</p>
</div>
<div class="listingblock">
<div class="title">Assets under management with "do" notation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">assetsUnderManagement2 = sum $
    map value do
        client    &lt;- bank.clients
        portfolio &lt;- client.portfolios
        portfolio.positions</code></pre>
</div>
</div>
<div class="paragraph">
<p>The single intermediate values must now be <em>drawn from</em> the list by means of the <code>&lt;-</code> arrow.
But wait! This looks and sounds utterly familiar and even has the same meaning as in list comprehensions!</p>
</div>
<div class="listingblock">
<div class="title">Assets under management with list comprehension</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">assetsUnderManagement3 = sum
    [value position |
        client    &lt;- bank.clients,
        portfolio &lt;- client.portfolios,
        position  &lt;- portfolio.positions
    ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>And in fact, both notations are equivalent and differ only in style.</p>
</div>
</div>
<div class="sect2">
<h3 id="_path_queries_almost_sql">Path queries - almost SQL</h3>
<div class="paragraph">
<p>Suppose we are not interested in <em>all</em> assets but only in the total value
of all Canoo shares in our bank. With a list comprehension, this is simple
to do and yields another interesting analogy to SQL queries.</p>
</div>
<div class="listingblock">
<div class="title">List comprehension as a query</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">allCanoo3 = sum
    [value position |                       -- SELECT
        client    &lt;- bank.clients,          -- FROM
        portfolio &lt;- client.portfolios,
        position  &lt;- portfolio.positions,
        position.ticker == CANO             -- WHERE
    ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>value</code> function is like a SQL projection, <code>position</code> is
a selection, the lists give the data source, and the guards
make the where-clauses.</p>
</div>
<div class="paragraph">
<p>We said that "do" notation is equivalent. Here is how it
looks with filters as where-clauses:</p>
</div>
<div class="listingblock">
<div class="title">Do notation with filter</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">allCanoo2 = sum $
    map value do
        client    &lt;- bank.clients
        portfolio &lt;- client.portfolios
        filter canoo portfolio.positions
    where
        canoo position = position.ticker == CANO</code></pre>
</div>
</div>
<div class="paragraph">
<p>One can see the subtle differences in style.</p>
</div>
<div class="paragraph">
<p>Finally, the path version with filtering.</p>
</div>
<div class="listingblock">
<div class="title">Path query with filter</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">allCanoo1 = sum $
    map value $
        bank.clients &gt;&gt;= Client.portfolios &gt;&gt;= filter canoo . Portfolio.positions where
            canoo position = position.ticker == CANO</code></pre>
</div>
</div>
<div class="paragraph">
<p>Such a filter can be placed at any step in the path and besides filtering,
one can just as well apply mapping inside the path evaluation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_it_all_falls_in_place">It all falls in place</h3>
<div class="paragraph">
<p>We started with an everyday business scenario and discovered some profound
properties of lists</p>
</div>
<div class="ulist">
<ul>
<li>
<p>they make nice path expressions</p>
</li>
<li>
<p>they can be used with the "do" notation</p>
</li>
<li>
<p>comprehensions are not so special</p>
</li>
<li>
<p>we can query a graph of references analogous to SQL</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Overall, comprehensions seem to be the most versatile notation, especially when
filtering and projection is needed anyway.
For mere aggregation, path notation is just fine.</p>
</div>
<div class="paragraph">
<p>Path expressions in other languages can also be rather succinct. Our running example
would for example be the Groovy GPath<br>
<code>bank.clients*.portfolios*.positions.findAll{it.ticker == CANO}*.value().sum()</code>
However, one cannot compare the visual appearance of the code only.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Lazy FTW</div>
<div class="paragraph">
<p>An important benefit of Frege is the lazy evaluation. The big graph is never
really materialized, neither are the "resulting lists" (there aren&#8217;t any).
The path does not build a large data structure but rather a stream
of evaluations.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_references_5">References</h3>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Groovy GPath
</td>
<td class="hdlist2">
<p><a href="http://docs.groovy-lang.org/latest/html/documentation/#gpath_expressions" class="bare">http://docs.groovy-lang.org/latest/html/documentation/#gpath_expressions</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
Haskell Wikibook
</td>
<td class="hdlist2">
<p><a href="https://en.wikibooks.org/wiki/Haskell/Understanding_monads/List" class="bare">https://en.wikibooks.org/wiki/Haskell/Understanding_monads/List</a></p>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="maybe_path">The Maybe path</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In "<a href="#fpath">Lists and path</a>" we have experienced how to construct path expressions
that are made up of list structures. We have also seen the <code>Maybe</code> type that signals
the (un-) availability of a value.</p>
</div>
<div class="paragraph">
<p>Today, we will see that the exact same kind of path expressions can arise when
multiple <code>Maybe</code> types are in play.</p>
</div>
<div class="sect2">
<h3 id="_the_domain_model_2">The domain model</h3>
<div class="paragraph">
<p>Coming back to our banking domain model, we now assume that the bank may have a <em>star</em>
client (think "Warren Buffet"). He may have a favorite, best performing portfolio: his <em>star</em>
portfolio with the most heeded position being - you guessed it - the optional <em>star</em> position.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="maybe_path_domain.png" alt="Stars in a simplified banking domain" width="610" height="98">
</div>
<div class="title">Figure 5. Stars in a simplified banking domain</div>
</div>
<div class="paragraph">
<p>Modeled with record syntax, the domain is easily expressed as below.
Note the similarity to the domain in "<a href="#fpath">Lists and path</a>".
We only replace <em>list of</em> types with <em>Maybe</em> and adapt the names.</p>
</div>
<div class="listingblock">
<div class="title">The core domain data structures</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">data Bank       = Bank      { star   :: Maybe Client     }
data Client     = Client    { star   :: Maybe Portfolio  }
data Portfolio  = Portfolio { star   :: Maybe Position   }
data Position   = Position  { soMany :: Int, ticker :: Ticker }</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A <code>Position</code> always has a ticker, even though that makes our live a little harder later.
      We want to keep it a bit "realistic".
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now let&#8217;s create an example bank with all optional values being available.</p>
</div>
<div class="listingblock">
<div class="title">The bank with all stars</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">starBank = Bank {
    star = Just Client {
        star = Just Portfolio {
            star = Just Position { soMany = 8, ticker = CANO }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>But there may be other banks, where either no star client is known or he doesn&#8217;t have a
preferred portfolio or there is no special position worth considering.</p>
</div>
<div class="listingblock">
<div class="title">Poor banks (hypothetical)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">noStarBank      = Bank { star = Nothing }
noPortfolioBank = Bank { star = Just Client { star = Nothing } }</code></pre>
</div>
</div>
<div class="paragraph">
<p>We may be foolish enough to think that we can make money by just investing
in the star client&#8217;s favorite ticker. To make that happen, we first have to find it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_first_cut">First cut</h3>
<div class="paragraph">
<p>To find the star ticker, we have to find the star position (if any) of the
star portfolio (if any) of the star client (if any).</p>
</div>
<div class="paragraph">
<p>Let&#8217;s make a <code>starTicker</code> function for that purpose that takes a <code>bank</code> and
if there is a star ticker, return just that and nothing otherwise.
In short, the type is</p>
</div>
<div class="listingblock">
<div class="content">
<pre>starTicker :: Bank -&gt; Maybe Ticker</pre>
</div>
</div>
<div class="paragraph">
<p>There are a number of straightforward ways of implementing this
(case discrimination, case expression, nested <em>if</em>, <em>maybe</em> function), all of which
lead to an intricate solution similar to the one below.</p>
</div>
<div class="listingblock">
<div class="title">Works but is difficult to read</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">starTicker bank = starPortfolio bank.star where
    starPortfolio Nothing = Nothing
    starPortfolio (Just client) = starPosition client.star where
        starPosition Nothing = Nothing
        starPosition (Just portfolio) = starTicker portfolio.star where
            starTicker Nothing = Nothing
            starTicker (Just position) = Just position.ticker</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s see whether this works as expected. Remember that <em>Nothing</em> may appear anywhere
in the process and we need to make sure that we never fall off the ship.</p>
</div>
<div class="listingblock">
<div class="title">Testing</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">import Test.QuickCheck

star1 = once $ starTicker starBank        == Just CANO
star2 = once $ starTicker noStarBank      == Nothing
star3 = once $ starTicker noPortfolioBank == Nothing</code></pre>
</div>
</div>
<div class="paragraph">
<p>While this approach works, we can certainly do better.</p>
</div>
</div>
<div class="sect2">
<h3 id="_improving_on_notation">Improving on notation</h3>
<div class="paragraph">
<p>Let&#8217;s step back and reconsider what we are doing here.</p>
</div>
<div class="paragraph">
<p>Looking at the involved functions and their types we see a similar pattern as in "<a href="#fpath">Lists and path</a>".</p>
</div>
<div class="listingblock">
<div class="content">
<pre>bank.star        --              Maybe Client    <b class="conum">(1)</b>
Client.star      -- Client    -&gt; Maybe Portfolio <b class="conum">(2)</b>
Portfolio.star   -- Portfolio -&gt; Maybe Position  <b class="conum">(3)</b>
Position.ticker  -- Position  -&gt; Ticker</pre>
</div>
</div>
<div class="paragraph">
<p>Each function returns a <em>Maybe</em> of the type that the next function takes as the input.
So maybe we can generalize over this pattern and <em>bind</em> the functions
such that we can put them in a line.</p>
</div>
<div class="paragraph">
<p>Binding &lt;1&gt; and &lt;2&gt; would be</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;1&gt;             &lt;2&gt;                            return type
Maybe Client -&gt; (Client -&gt; Maybe Portfolio) -&gt; Maybe Portfolio</pre>
</div>
</div>
<div class="paragraph">
<p>Binding &lt;2&gt; and &lt;3&gt; would be</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;2&gt;                &lt;3&gt;                              return type
Maybe Portfolio -&gt; (Portfolio -&gt; Maybe Position) -&gt; Maybe Position</pre>
</div>
</div>
<div class="paragraph">
<p>As you see, there is a general pattern behind it such that <em>bind</em> has the type:<br>
<code>Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b</code></p>
</div>
<div class="paragraph">
<p>You will be glad to hear that this <em>bind</em> function is already available and just like in the
cases of "<a href="#easy_io">Easy IO</a>" and "<a href="#fpath">Lists and path</a>", it is denoted with the <code>&gt;&gt;=</code> operator.</p>
</div>
<div class="paragraph">
<p>So combining &lt;1&gt; and &lt;2&gt; becomes
<code>bank.star &gt;&gt;= Client.star</code></p>
</div>
<div class="paragraph">
<p>Combining &lt;2&gt; and &lt;3&gt; becomes
<code>Client.star &gt;&gt;= Portfolio.star</code></p>
</div>
<div class="paragraph">
<p>Combining (&lt;1&gt; and &lt;2&gt;) and &lt;3&gt; becomes<br>
<code>bank.star &gt;&gt;= Client.star &gt;&gt;= Portfolio.star</code></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="title">Tadaaaa!</div>
We have <em>again</em> arrived at a simple "path" expression, this time for the optional star position of the optional star
portfolio of the optional star client!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To complete the task, here is the solution in a single path.</p>
</div>
<div class="listingblock">
<div class="title">Chaining Maybe values in a path</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">starTicker bank =
    bank.star &gt;&gt;= Client.star &gt;&gt;= Portfolio.star &gt;&gt;= \position -&gt; Just position.ticker</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>Position.ticker</code> would also be a <em>Maybe</em> type then chaining would be even nicer.
But this variant is more realistic, since there can never be a position without a ticker.
It is also instructive to see this variant where the argument that is passed to the function
is captured in the lambda parameter.</p>
</div>
<div class="paragraph">
<p>We can simply follow the types. As we have seen in "<a href="#silence">Silent notation</a>"</p>
</div>
<div class="listingblock">
<div class="content">
<pre>\position -&gt; Just position.ticker   -- Position -&gt; Maybe Ticker</pre>
</div>
</div>
<div class="paragraph">
<p>is just another notation for</p>
</div>
<div class="listingblock">
<div class="content">
<pre>foo :: Position -&gt; Maybe Ticker
foo position = Just position.ticker</pre>
</div>
</div>
<div class="paragraph">
<p>and we spare the headaches of finding a good name for it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_do_notation_again">The "do" notation, again</h3>
<div class="paragraph">
<p>Meanwhile it should come at no surprise that where there is <em>bind</em>, the "do" notation is
just around the corner.</p>
</div>
<div class="listingblock">
<div class="title">The star ticker with "do" notation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">starTicker bank = do
    warrenBuffet  &lt;- bank.star
    starPortfolio &lt;- warrenBuffet.star
    starPosition  &lt;- starPortfolio.star
    Just starPosition.ticker</code></pre>
</div>
</div>
<div class="paragraph">
<p>This reads actually pretty nicely and works just like we want it. Note again that each step
may evaluate to a <code>Nothing</code> in which case the function returns <em>immediately</em> <code>Nothing</code>
without any further step being evaluated.</p>
</div>
</div>
<div class="sect2">
<h3 id="_comparing_approaches">Comparing approaches</h3>
<div class="paragraph">
<p>The <code>Maybe</code> type turns out to be very versatile in both path expressions and
when used with the "do" notation.</p>
</div>
<div class="paragraph">
<p>Path expressions in other languages can also be rather succinct. Our running example
would for example be the Groovy GPath
<code>bank.star?.star?.star?.ticker</code>, returning <em>null</em> if any step in path was <em>null</em>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">There is no <em>null</em>.</div>
<div class="paragraph">
<p>Remember: there is no <em>null</em> in Frege and thus no <em>NullPointerExceptions</em>.
One cannot say that often enough.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>However, one cannot compare the visual appearance of the code only.</p>
</div>
<div class="paragraph">
<p>Frege has the advantage of carrying the <em>Maybe</em> context through the type
system ensuring that the caller never forgets that the value may be unavailable.</p>
</div>
<div class="paragraph">
<p>Java would have a similar effect if its NullPointerException was a "checked
exception" (which it is not). There is an <em>Optional</em> type since Java 8 with a
method <code>flatMap</code> that works similar to our <em>bind</em>. Time will tell how good
that abstraction works in Java.</p>
</div>
</div>
<div class="sect2">
<h3 id="_references_6">References</h3>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Groovy Null-Safe
</td>
<td class="hdlist2">
<p><a href="http://groovy-lang.org/operators.html#_safe_navigation_operator" class="bare">http://groovy-lang.org/operators.html#_safe_navigation_operator</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
Learn you a Haskell
</td>
<td class="hdlist2">
<p><a href="http://www.learnyouahaskell.com/a-fistful-of-monads" class="bare">http://www.learnyouahaskell.com/a-fistful-of-monads</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
Java 8 Optionals
</td>
<td class="hdlist2">
<p><a href="http://www.oracle.com/technetwork/articles/java/java8-optional-2175753.html" class="bare">http://www.oracle.com/technetwork/articles/java/java8-optional-2175753.html</a>
(possibly contains some errors)</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fizzbuzz">FizzBuzz</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is a children&#8217;s game that is sometimes used as a simple programming
task and it goes like so:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>count the numbers 1, 2, 3, &#8230;&#8203;</p>
</li>
<li>
<p>instead of every third number say "fizz"</p>
</li>
<li>
<p>instead of every fifth number say "buzz"</p>
</li>
<li>
<p>when fizz and buzz fall together, say "fizzbuzz".</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While this is a rather trivial task, it can anyway bring some insight about
functional design and modularity - if we only dare to question our conventional
approach and are bold enough to leave our comfort zone.</p>
</div>
<div class="sect2">
<h3 id="_the_pieces">The pieces</h3>
<div class="paragraph">
<p>There are many ways to solve the task and we will follow a path that may
seem a bit unfamiliar when you come from imperative, object oriented
programming: we will combine infinite productions.</p>
</div>
<div class="paragraph">
<p>First, we need an infinite production of numbers. In Frege that is
used so often that it has it&#8217;s own idiom:</p>
</div>
<div class="listingblock">
<div class="title">All numbers</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">[1..]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Second, we need a pattern like "every third item" for the fizzes.
We model this as an endless repetition of strings, which are
all empty, except every third one is "fizz".</p>
</div>
<div class="listingblock">
<div class="title">The infinite fizz pattern</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">fizzes = cycle [&quot;&quot;, &quot;&quot;, &quot;fizz&quot;]</code></pre>
</div>
</div>
<div class="paragraph">
<p>By now, you will have guessed what the buzzes pattern looks like.</p>
</div>
<div class="listingblock">
<div class="title">The infinite buzz pattern</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">buzzes = cycle [&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;buzz&quot;]</code></pre>
</div>
</div>
<div class="paragraph">
<p>These are all the pieces we need. Note how naturally they follow from the
specification.</p>
</div>
</div>
<div class="sect2">
<h3 id="_combining_rules">Combining rules</h3>
<div class="paragraph">
<p>Now we have to combine the parts. First, we have to create a pattern
that combines fizzes and buzzes such that we get a pattern like<br>
<code>"", "", "fizz", "", "buzz", "fizz", "", ...</code></p>
</div>
<div class="paragraph">
<p>It can be created by simply concatenating fizzes and buzzes item-wise,
to create a new, endless production:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>fizzes:  "", "", "fizz", "", "",     "fizz", "", ...
buzzes:  "", "", "",     "", "buzz", "",     "", ...
(++)  :  "", "", "fizz", "", "buzz", "fizz", "", ...</pre>
</div>
</div>
<div class="listingblock">
<div class="title">The infinite fizz-buzz pattern</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">pattern = zipWith (++) fizzes buzzes</code></pre>
</div>
</div>
<div class="paragraph">
<p>One can view this pattern as a new <em>rule</em> that is constructed as
a combination of the previous primitive rules.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">For the Geeks</div>
<div class="paragraph">
<p>We make use of the fact that concatenating the empty string at the
front or at the rear leaves a string unchanged.
Strings actually form a <em>Monoid</em> under concatenation with ""
as the neutral element. The operation is also
associative, which would be required
if we combined three or more rules.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>We now have an infinite fizzbuzz pattern.</p>
</div>
</div>
<div class="sect2">
<h3 id="_combine_with_numbers">Combine with numbers</h3>
<div class="paragraph">
<p>Now we can superimpose the pattern on the infinite list of numbers
to get the final infinite production.</p>
</div>
<div class="listingblock">
<div class="title">The final fizzbuzz solution</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">fizzes   = cycle [&quot;&quot;, &quot;&quot;, &quot;fizz&quot;]
buzzes   = cycle [&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;buzz&quot;]
pattern  = zipWith (++) fizzes buzzes
fizzbuzz = zipWith combine pattern [1..] where
    combine word number = if null word
                             then show number
                             else word</code></pre>
</div>
</div>
<div class="paragraph">
<p>These infinite productions are very versatile to use.
We have already seen twice how to combine them, but they
can also be easily filtered and selected from for printing.</p>
</div>
<div class="listingblock">
<div class="title">Showing parts of the infinite production</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="frege">main _ = do
    println $ take 5 $ drop 200 fizzbuzz

--  [&quot;fizz&quot;, &quot;202&quot;, &quot;203&quot;, &quot;fizz&quot;, &quot;buzz&quot;]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_considerations">Considerations</h3>
<div class="paragraph">
<p>When searching the web, you will find solutions like the one below, which has
actually been the #1 hit.</p>
</div>
<div class="listingblock">
<div class="title">FizzBuzz in Java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">FizzBuzz</span>{
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args){
        <span class="keyword">for</span>(<span class="type">int</span> i= <span class="integer">1</span>; i &lt;= <span class="integer">100</span>; i++){
            <span class="keyword">if</span>(i % <span class="integer">15</span> == <span class="integer">0</span>){
                <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">FizzBuzz</span><span class="delimiter">&quot;</span></span>);
            }<span class="keyword">else</span> <span class="keyword">if</span>(i % <span class="integer">3</span> == <span class="integer">0</span>){
                <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fizz</span><span class="delimiter">&quot;</span></span>);
            }<span class="keyword">else</span> <span class="keyword">if</span>(i % <span class="integer">5</span> == <span class="integer">0</span>){
                <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Buzz</span><span class="delimiter">&quot;</span></span>);
            }<span class="keyword">else</span>{
                <span class="predefined-type">System</span>.out.println(i);
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>While the imperative solution will be more familiar to many readers (and until recently
that would have included myself) there are hard facts that reveal how
intertwined the imperative solution is compared to the simple, modular one in Frege.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Conditionals</dt>
<dd>
<p>Programming errors are more likely to appear the more conditionals are in the code.
In nested conditionals the probability of errors increases exponentially
(at least for me).<br>
<em>Java: 4 conditionals, 3 of them nested (complexity 3)<br>
Frege: 1 conditional (complexity 0)</em></p>
</dd>
<dt class="hdlist1">Operators</dt>
<dd>
<p>The more operators there are in my code, the more likely errors
creep in. With combination of operators the probability of errors
increases exponentially (at least for me).<br>
<em>Java: 7 (it would be 10 when using i % 3 == 0 &amp;&amp; i % 5 == 0)<br>
Frege: 1</em></p>
</dd>
<dt class="hdlist1">Sequencing</dt>
<dd>
<p>What can go wrong if I get the sequence of operations wrong?<br>
<em>Java: I <strong>must</strong> first handle the % 15 case, then the % 3 and %5 cases, then the number case.
Any other sequence is <strong>wrong</strong>!<br>
Frege: <strong>any</strong> ordering of the lines is
<strong>equally correct</strong>! (Referential transparency).</em></p>
</dd>
<dt class="hdlist1">Maintainability</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>What pieces of the code do you have to change to show some other part of the
fizzbuzz sequence? <br>
<em>Java: have to rework the loop<br>
Frege: change one number</em></p>
</li>
<li>
<p>How much code do you have to touch when not printing to <code>stdout</code> but to <code>stderr</code>?<br>
<em>Java: 4 lines<br>
Frege: 1 line</em></p>
</li>
<li>
<p>How much code do you have to touch when a rule changes? What if there are new
multiples that need to be included?<br>
<em>Java: everything must be reworked (and correct sequencing will be tricky)<br>
Frege: small, localized change</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Specification</dt>
<dd>
<p>How well is the specification reflected in the implementation?<br>
<em>Java: very indirectly (where is modulo 15 in the spec?)<br>
Frege: exact one-to-one correspondence</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In his seminal paper "Why functional programming matters", John Hughes makes the point that
one main benefit is <strong>improved modularity</strong> by separating production of data from its usage and
combining simple pieces of logic.<br>
The fizzbuzz task is an compelling evidence for that claim.</p>
</div>
</div>
<div class="sect2">
<h3 id="_references_7">References</h3>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Why FP matters
</td>
<td class="hdlist2">
<p><a href="http://www.cs.kent.ac.uk/people/staff/dat/miranda/whyfp90.pdf" class="bare">http://www.cs.kent.ac.uk/people/staff/dat/miranda/whyfp90.pdf</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
Simplicity
</td>
<td class="hdlist2">
<p>Rich Hickey, RailsConf Keynote 2012 <a href="https://www.youtube.com/watch?v=rI8tNMsozo0" class="bare">https://www.youtube.com/watch?v=rI8tNMsozo0</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
RxJava
</td>
<td class="hdlist2">
<p>An interesting solution by Tim Yates <a href="https://gist.github.com/timyates/0d6b47e429023630a750" class="bare">https://gist.github.com/timyates/0d6b47e429023630a750</a></p>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-04-03 18:55:00 MESZ
</div>
</div>
</body>
</html>